<?php
/**
 * @var array|null $recovery_flow
 * 'user' => [
 *   'uid'      => $u->getUID(),
 *   'fullname' => $u->getFullName(),
 *   #'avatar'  => $userAvatarUrl
 *  ],
 *  '_link' => '/recover/signin/challenge/586a484fe39b7',
 */

use Module\HttpFoundation\Actions\Url;
use Module\OAuth2\Actions\User\RegisterPage;

\Module\HttpFoundation\Actions::htmlHeadTitle('Register');

\Module\HttpFoundation\Actions::htmlScript()
    ->attachFile(\Module\Foundation\Actions::path('www-alter').'/js/pages/register.js')
    ->attachFile(\Module\Foundation\Actions::path('www-alter').'/js/pages/common.js')
;

if (\Module\HttpFoundation\Actions::flashMessage(RegisterPage::FLASH_MESSAGE_ID)->hasMessages())
    echo \Module\Foundation\Actions::view( 'partial/flashMessage', \Module\HttpFoundation\Actions::flashMessage(RegisterPage::FLASH_MESSAGE_ID)->fetchMessages() );

?>

<?php
// RECOVERY FOLLOW FOR ACCOUNT REGISTRY THAT EXISTS
if (isset($recovery_flow)) {
    ?>
    <div class="login_page_wrapper">
        <div class="md-card" id="login_card">
            <div class="md-card-content large-padding" id="login_form">
                <form action="<?php echo \Module\HttpFoundation\Actions::url('main/oauth/recover/signin_challenge', [ 'uid' => $recovery_flow['user']['uid'] ], Url::DEFAULT_INSTRUCT|Url::APPEND_CURRENT_REQUEST_QUERY) ?>" method="post" novalidate>
                    <div class="uk-form-row" id="recognizeImages">
                        <img src="<?php echo \Module\Foundation\Actions::path('www-alter').'/img/user.png' ?>">
                        <p><?php echo $recovery_flow['user']['fullname']; ?></p>
                        <p><?php echo $recovery_flow['user']['identifier_exists']; ?></p>
                        <b><span class="uk-form-help-block">اگر این شما هستید، قبلا در سیستم ثبت نام شده اید.</span></b>
                        <br/>
                        <span class="uk-form-help-block">
                            <?php echo sprintf(
                                ' کلمه عبور را به خاطر دارید؟ از %s وارد شوید.'
                                , sprintf('<a href="%s">این لینک</a>', \Module\HttpFoundation\Actions::url('main/oauth/login', [], Url::DEFAULT_INSTRUCT|Url::APPEND_CURRENT_REQUEST_QUERY) )
                            ) ?>
                        </span>
                        <span class="uk-form-help-block">و یا برای تلاش برای ورود به سیستم روی دکمه زیر کلیک کنید.</span>
                    </div>
                    <div class="uk-margin-medium-top">
                        <button type="submit" class="md-btn md-btn-primary md-btn-block md-btn-large font-is">تلاش برای ورود به سیستم</button>
                    </div>
                    <a href="<?php echo \Module\HttpFoundation\Actions::url('main/oauth/register', [], Url::DEFAULT_INSTRUCT|Url::APPEND_CURRENT_REQUEST_QUERY) ?>" id="backStep" class="uk-position-top-right uk-close uk-margin-right uk-margin-top"></a>
                </form>
            </div>

        </div>
    </div>
<?php
     // we don't want display sections below
} else {
?>

<div class="login_page_wrapper">
    <div class="md-card" id="login_card">
        <div class="md-card-content large-padding" id="register_form">
            <h2 class="heading_a uk-margin-medium-bottom font-is">عضویت در سامانه</h2>
            <form action="<?php echo \Module\HttpFoundation\Actions::url('main/oauth/register', [], Url::DEFAULT_INSTRUCT|Url::APPEND_CURRENT_REQUEST_QUERY) ?>" method="POST" novalidate>
                <div class="uk-form-row">
                    <div class="parsley-row">
                        <label class="label-required" for="register_fullname">نام کامل</label>
                        <input class="md-input font-is" type="text" id="register_fullname" name="fullname" required/>
                    </div>
                </div>
                <div class="uk-form-row">
                    <div class="parsley-row">
                        <label class="label-required" for="email">ایمیل</label>
                        <input value="" class="md-input font-is" type="text" id="email" name="email" autocomplete="off" required/>
                        <p class="form-hint">نمونه: example@example.com</p>
                    </div>
                </div>
                <div class="uk-form-row">
                    <div class="parsley-row uk-form-password">
                        <label class="label-required" for="password">گذرواژه</label>
                        <input value="" class="md-input font-is" type="password" id="password" name="credential" minlength="6" maxlength="32" autocomplete="off" required/>
                        <a href="" class="uk-form-password-toggle" data-uk-form-password="{lblShow:'نمایش', lblHide:'پنهان'}">نمایش</a>
                    </div>
                </div>
                <div class="uk-form-row uk-grid">
                    <div class="uk-width-1-2">
                        <label for="register_email">شماره همراه</label>
                        <input class="md-input font-is" type="text" id="register_phone" name="mobile[number]"/>
                    </div>
                    <div class="uk-width-1-2">
                        <input id="register_country" class="uk-form-width-medium" placeholder="کشور" name="mobile[country]" disabled/>
                    </div>
                </div>

                <div class="uk-margin-medium-top">
                    <button type="submit" class="md-btn md-btn-primary md-btn-block md-btn-large font-is">ثبت نام</button>
                </div>

                <hr/>
                <span class="uk-form-help-block">* فیلد های ستاره دار باید حتما پر شوند! </span>

            </form>
        </div>
    </div>

    <div class="uk-margin-top uk-text-center">
        <a href="<?php echo \Module\HttpFoundation\Actions::url('main/oauth/login', [], Url::DEFAULT_INSTRUCT|Url::APPEND_CURRENT_REQUEST_QUERY) ?>">اگر ثبت نام کرده اید، از اینجا وارد شوید.</a>
    </div>
</div>
<?php } ?>